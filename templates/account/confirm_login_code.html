{% extends "account/_base.html" %}

{% load i18n %}
{% load account %}
{% load widget_tweaks %}

{% block title %}
  {% trans "Enter sign-in code" %}
{% endblock title %}
{% block content %}
  <section class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-7 col-sm-10">
        <div class="d-flex flex-column align-items-center gap-2">
          <h1>
            {% trans "Enter sign-in code" %}
          </h1>
          <p>
            {% blocktrans trimmed %}
              We've sent a code to <a href="mailto:{{ email }}">{{ email }}</a>. The code expires shortly, so please enter it soon.
            {% endblocktrans %}
          </p>
        </div>
        {% if verify_form.non_field_errors %}
          <div class="alert alert-danger" role="alert">
            <ul class="list-unstyled mb-0">
              {% for error in verify_form.non_field_errors %}
                <li>
                  {{ error }}
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
        {% with WIDGET_ERROR_CLASS="border-danger" %}
          {% trans "Code" as code_label %}
          <form method="post"
                action="{% url 'account_confirm_login_code' %}"
                novalidate>
            {% csrf_token %}
            {% if redirect_field_value %}
              <input type="hidden"
                     name="{{ redirect_field_name }}"
                     value="{{ redirect_field_value }}" />
            {% endif %}
            <div class="d-flex flex-column gap-4 mt-4">
              <div class="d-flex flex-column gap-2 mb-2">
                <label for="{{ verify_form.code.id_for_label }}"
                       class="form-label visually-hidden">
                  {{ code_label }}
                </label>
                {% render_field verify_form.code
                class="form-control form-control-lg"
                placeholder=code_label
                autocomplete="one-time-code"
                inputmode="numeric"
                autofocus="autofocus" %}
                {% if verify_form.code.errors %}
                  <div class="invalid-feedback d-block">
                    <ul class="list-unstyled mb-0">
                      {% for error in verify_form.code.errors %}
                        <li>
                          {{ error }}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                {% endif %}
              </div>
              <div class="d-flex flex-column gap-3">
                <button type="submit" class="btn btn-lg btn-primary">
                  {% trans "Confirm" %}
                </button>
                {% if can_resend %}
                  <button type="submit" form="resend" class="btn btn-lg btn-outline-warning">
                    {% trans "Request new code" %}
                  </button>
                {% endif %}
                {% if cancel_url %}
                  <a href="{{ cancel_url }}" class="btn btn-lg btn-outline-secondary">
                    {% trans "Cancel" %}
                  </a>
                {% else %}
                  <button type="submit"
                          form="logout-from-stage"
                          class="btn btn-lg btn-outline-secondary">
                    {% trans "Cancel" %}
                  </button>
                {% endif %}
              </div>
            </div>
          </form>
        {% endwith %}
        <form id="resend"
              method="post"
              action="{% url 'account_confirm_login_code' %}"
              class="d-none">
          <input type="hidden" name="action" value="resend" />
          {% if redirect_field_value %}
            <input type="hidden"
                   name="{{ redirect_field_name }}"
                   value="{{ redirect_field_value }}" />
          {% endif %}
          {% csrf_token %}
        </form>
        {% if not cancel_url %}
          <form id="logout-from-stage"
                method="post"
                action="{% url 'account_logout' %}"
                class="d-none">
            <input type="hidden" name="next" value="{% url 'account_login' %}" />
            {% csrf_token %}
          </form>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock content %}
