{% extends "account/_base.html" %}

{% load i18n %}
{% load allauth %}
{% load widget_tweaks %}

{% block title %}
  {% trans "Change password" %}
{% endblock title %}
{% block content %}
  <section class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-7 col-sm-10">
        <div class="d-flex flex-column align-items-center gap-2">
          <h1>
            {% if token_fail %}
              {% trans "Bad token" %}
            {% else %}
              {% trans "Change password" %}
            {% endif %}
          </h1>
          <p>
            {% url 'account_reset_password' as password_reset_url %}
            {% if token_fail %}
              {% blocktrans trimmed %}
                The password reset link was invalid, possibly because it has already been used. Please request a <a href="{{ password_reset_url }}">new password reset</a>.
              {% endblocktrans %}
            {% else %}
              {% blocktrans trimmed %}
                Use 8 or more characters with a mix of letters (uppercase and
                lowercase), numbers & symbols.
              {% endblocktrans %}
            {% endif %}
          </p>
        </div>
        {% if not token_fail %}
          {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
              <ul class="list-unstyled mb-0">
                {% for error in form.non_field_errors %}
                  <li>
                    {{ error }}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
          {% with WIDGET_ERROR_CLASS="border-danger" %}
            {% trans "Password" as password_label %}
            {% trans "Confirm password" as password2_label %}
            <form method="post" action="." novalidate>
              {% csrf_token %}
              {% if redirect_field_value %}
                <input type="hidden"
                       name="{{ redirect_field_name }}"
                       value="{{ redirect_field_value }}" />
              {% endif %}
              <div class="d-flex flex-column gap-4 mt-4">
                <div class="d-flex flex-column gap-2 mb-2">
                  <div class="password-toggle">
                    <label for="{{ form.password1.id_for_label }}"
                           class="form-label visually-hidden">
                      {{ password_label }}
                    </label>
                    {% render_field form.password1
                    class="form-control form-control-lg"
                    placeholder=password_label
                    autocomplete="new-password" %}
                    <label class="password-toggle-btn">
                      <input type="checkbox" class="password-toggle-check" />
                      <span class="password-toggle-indicator"></span>
                    </label>
                  </div>
                  {% if form.password1.errors %}
                    <div class="invalid-feedback d-block">
                      <ul class="list-unstyled mb-0">
                        {% for error in form.password1.errors %}
                          <li>
                            {{ error }}
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                </div>
                <div class="d-flex flex-column gap-2">
                  <div class="password-toggle">
                    <label for="{{ form.password2.id_for_label }}"
                           class="form-label visually-hidden">
                      {{ password2_label }}
                    </label>
                    {% render_field form.password2
                    class="form-control form-control-lg"
                    placeholder=password2_label
                    autocomplete="new-password" %}
                    <label class="password-toggle-btn">
                      <input type="checkbox" class="password-toggle-check" />
                      <span class="password-toggle-indicator"></span>
                    </label>
                  </div>
                  {% if form.password2.errors %}
                    <div class="invalid-feedback d-block">
                      <ul class="list-unstyled mb-0">
                        {% for error in form.password2.errors %}
                          <li>
                            {{ error }}
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                </div>
                <button type="submit" class="btn btn-lg btn-primary">
                  {% trans "Change password" %}
                </button>
                {% if user.is_authenticated %}
                  <a href="{% url 'store:index' %}" class="btn btn-lg btn-secondary">
                    {% trans "Return to home" %}
                  </a>
                {% else %}
                  <a href="{% url 'account_login' %}" class="btn btn-lg btn-secondary">
                    {% trans "Return to login" %}
                  </a>
                {% endif %}
              </div>
            </form>
          {% endwith %}
        {% else %}
          <div class="d-flex flex-column gap-4 mt-4">
            {% if user.is_authenticated %}
              <a href="{% url 'store:index' %}" class="btn btn-lg btn-primary">
                {% trans "Return to home" %}
              </a>
            {% else %}
              <a href="{% url 'account_login' %}" class="btn btn-lg btn-primary">
                {% trans "Return to login" %}
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock content %}
